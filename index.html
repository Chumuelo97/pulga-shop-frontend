<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Externa de Ejemplo</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        #cart-iframe {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            border: none;
            z-index: 9999;
            pointer-events: none;
        }
    </style>
</head>

<body>

    <h1>Tienda Externa (Demo)</h1>
    <p>Esta pÃ¡gina simula un sitio web externo que utiliza el servicio de carrito de PulgaShop.</p>
    <div class="product-grid">
        <div class="product-card">
            <img src="https://via.placeholder.com/200" alt="Producto Externo 1" class="product-image">
            <h3>Producto Externo A</h3>
            <p>$10.000 CLP</p>
            <button class="add-btn"
                onclick="addToCart(101, 'Producto Externo A', 10000, 'https://via.placeholder.com/200')">
                Agregar al Carrito
            </button>
        </div>
        <div class="product-card">
            <img src="https://via.placeholder.com/200" alt="Producto Externo 2" class="product-image">
            <h3>Producto Externo B</h3>
            <p>$25.000 CLP</p>
            <button class="add-btn"
                onclick="addToCart(102, 'Producto Externo B', 25000, 'https://via.placeholder.com/200')">
                Agregar al Carrito
            </button>
        </div>
    </div>
    <!-- Iframe del Carrito -->
    <iframe id="cart-iframe" src="http://localhost:3000/embed/cart"></iframe>

    <!-- BotÃ³n Flotante -->
    <button class="cart-fab" onclick="openCart()" aria-label="Abrir carrito">
        ðŸ›’
        <span id="cart-badge" class="cart-notification">0</span>
    </button>

    <script>
        const cartIframe = document.getElementById('cart-iframe');
        const cartBadge = document.getElementById('cart-badge');
        const cartFab = document.querySelector('.cart-fab');

        // FunciÃ³n para enviar mensajes al iframe
        function addToCart(id, name, price, imageUrl) {
            const product = {
                id,
                name,
                price,
                quantity: 1,
                imageUrl
            };

            // Enviamos el mensaje al iframe
            cartIframe.contentWindow.postMessage({
                type: 'ADD_TO_CART',
                product: product,
                autoOpen: false
            }, 'http://localhost:3000');
        }

        function openCart() {
            cartIframe.contentWindow.postMessage({
                type: 'OPEN_CART'
            }, 'http://localhost:3000');
        }

        // Escuchar mensajes del iframe (opcional, por si el carrito quiere decirnos algo)
        window.addEventListener('message', (event) => {
            if (event.origin !== 'http://localhost:3000') return;
            if (event.data.type === 'CART_UPDATED') {
                const count = event.data.totalItems;
                cartBadge.textContent = count;
                if (count > 0) {
                    cartBadge.classList.add('visible');
                } else {
                    cartBadge.classList.remove('visible');
                }
            } else if (event.data.type === 'CART_CONFIG') {
                const config = event.data.config;
                if (config.styles) {
                    let styleTag = document.getElementById('cart-dynamic-styles');
                    if (!styleTag) {
                        styleTag = document.createElement('style');
                        styleTag.id = 'cart-dynamic-styles';
                        document.head.appendChild(styleTag);
                    }
                    styleTag.textContent = config.styles;
                }
            }
        });
    </script>
</body>

</html>